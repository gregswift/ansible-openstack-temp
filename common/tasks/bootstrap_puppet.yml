- name: Ensure puppet to our working version
  action: yum pkg=puppet state=installed

- name: Ensure facter is at our working version
  action: yum pkg=facter state=installed

- name: Register system with puppet
  action: command /usr/bin/puppet agent apply --server=$puppetmaster --environment=$environment --pluginsync --waitforcert 300
    creates=/var/lib/puppet/ssl/certs/${fqdn}.pem
