- name: Ensure puppet related related packages are installed
  action: yum pkg=$item state=installed
  with_items:
    - puppet
    - facter

- name: Register system with puppet
  action: command /usr/bin/puppet agent apply --server=$puppetmaster --environment=$environment --pluginsync --waitforcert 300
    creates=/var/lib/puppet/ssl/certs/${fqdn}.pem
