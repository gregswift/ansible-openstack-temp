- hosts: controller
  user: root
  vars_files:
  - "vars/config.yml"
  vars:
    - host: $chef_ip
    - clients: localhost
    - roles: "'role[single-controller]','recipe[gravity-bu::default]'"
  tasks:
    - include: common/tasks/run_chef.yml

- hosts: compute
  user: root
  vars_files:
  - "vars/config.yml"
  vars:
    - host: ${hostvars.${groups.controller[0]}.ansible_eth0.ipv4.address}
    - clients: ${groups.compute}
    - roles: "'role[single-compute]'"
  tasks:
    - include: common/tasks/run_chef.yml
